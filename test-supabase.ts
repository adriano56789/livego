/**
 * Script de teste para verificar conex√£o com Supabase
 *
 * Execute este arquivo para testar a conex√£o:
 * npx tsx test-supabase.ts
 */

import { supabase, supabaseHelpers } from './services/supabase';

async function testConnection() {
  console.log('üîå Testando conex√£o com Supabase...\n');

  try {
    // Teste 1: Conex√£o b√°sica
    console.log('1. Testando conex√£o b√°sica...');
    const { data, error } = await supabase.from('users').select('count').single();
    if (error) throw error;
    console.log('‚úÖ Conex√£o OK!\n');

    // Teste 2: Buscar presentes
    console.log('2. Buscando presentes...');
    const gifts = await supabaseHelpers.getGifts();
    console.log(`‚úÖ ${gifts.length} presentes encontrados:`);
    gifts.slice(0, 5).forEach(g => {
      console.log(`   - ${g.name}: ${g.price} diamantes ${g.icon}`);
    });
    console.log();

    // Teste 3: Buscar usu√°rios
    console.log('3. Buscando usu√°rios...');
    const users = await supabaseHelpers.getAllUsers();
    console.log(`‚úÖ ${users.length} usu√°rios encontrados\n`);

    // Teste 4: Criar usu√°rio de teste
    console.log('4. Criando usu√°rio de teste...');
    try {
      const testUser = await supabaseHelpers.createUser({
        identification: `test-${Date.now()}`,
        name: 'Usu√°rio Teste',
        avatar_url: 'https://i.pravatar.cc/150?img=1',
        country: 'br',
        age: 25,
        gender: 'not_specified'
      });
      console.log('‚úÖ Usu√°rio criado:', testUser.name);
      console.log(`   ID: ${testUser.id}\n`);

      // Teste 5: Atualizar usu√°rio
      console.log('5. Atualizando usu√°rio...');
      const updated = await supabaseHelpers.updateUser(testUser.id, {
        diamonds: 1000
      });
      console.log(`‚úÖ Usu√°rio atualizado! Diamantes: ${updated.diamonds}\n`);

    } catch (err: any) {
      if (err.code === '23505') {
        console.log('‚ö†Ô∏è  Usu√°rio j√° existe (isso √© normal)\n');
      } else {
        throw err;
      }
    }

    console.log('üéâ Todos os testes passaram!\n');
    console.log('üìù Pr√≥ximos passos:');
    console.log('   1. Leia o arquivo SUPABASE_SETUP.md');
    console.log('   2. Substitua o import da API no seu c√≥digo');
    console.log('   3. Comece a usar o Supabase!\n');

  } catch (error: any) {
    console.error('‚ùå Erro:', error.message);
    console.error('\nüîç Verifique:');
    console.error('   - As vari√°veis no arquivo .env');
    console.error('   - Se o Supabase est√° acess√≠vel');
    console.error('   - As pol√≠ticas RLS no dashboard\n');
  }
}

testConnection();
